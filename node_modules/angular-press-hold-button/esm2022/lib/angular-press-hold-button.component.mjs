import { CommonModule } from '@angular/common';
import { Component, EventEmitter, Input, Output, ViewChild, } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "@angular/common";
export class AngularPressHoldButton {
    constructor(renderer) {
        this.renderer = renderer;
        this.duration = 1500;
        this.backgroundColor = '#3498db';
        this.progressColor = '#2980b9';
        this.labelStart = '';
        this.labelProgress = '';
        this.labelFinish = '';
        this.actionStarted = new EventEmitter();
        this.actionCancelled = new EventEmitter();
        this.actionFinished = new EventEmitter();
        this.label = '';
        this.currentState = 'start';
        this.progressWidth = 0;
    }
    ngOnInit() {
        this.label = this.labelStart;
    }
    startAction(event) {
        event.preventDefault();
        if (this.progressWidth < 100) {
            this.clearProgress();
            this.label = this.labelProgress;
            this.currentState = 'progress';
            this.actionStarted.emit();
            this.progressInterval = setInterval(() => {
                this.progressWidth = Math.min(100, this.progressWidth + 100 / (this.duration / 100));
                this.updateProgress();
                if (this.progressWidth >= 100) {
                    this.actionSuccess();
                }
            }, 100);
        }
    }
    stopAction(event) {
        if (event) {
            event.preventDefault();
        }
        if (this.progressWidth < 100) {
            this.label = this.labelStart;
            this.currentState = 'start';
            this.actionCancelled.emit();
            clearInterval(this.progressInterval);
            this.progressInterval = setInterval(() => {
                this.progressWidth = Math.max(0, this.progressWidth - 100 / (this.duration / 100));
                this.updateProgress();
                if (this.progressWidth <= 0) {
                    clearInterval(this.progressInterval);
                }
            }, 100);
        }
    }
    actionSuccess() {
        clearInterval(this.progressInterval);
        this.label = this.labelFinish;
        this.currentState = 'finish';
        this.actionFinished.emit();
    }
    updateProgress() {
        if (this.progressBar && this.progressBar.nativeElement) {
            this.renderer.setStyle(this.progressBar.nativeElement, 'width', `${this.progressWidth}%`);
        }
    }
    clearProgress() {
        if (this.progressWidth < 100 && this.progressInterval) {
            clearInterval(this.progressInterval);
        }
        this.progressWidth = 0;
        this.updateProgress();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.2.1", ngImport: i0, type: AngularPressHoldButton, deps: [{ token: i0.Renderer2 }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.2.1", type: AngularPressHoldButton, isStandalone: true, selector: "angular-press-hold-button", inputs: { duration: "duration", backgroundColor: "backgroundColor", progressColor: "progressColor", labelStart: "labelStart", labelProgress: "labelProgress", labelFinish: "labelFinish" }, outputs: { actionStarted: "actionStarted", actionCancelled: "actionCancelled", actionFinished: "actionFinished" }, viewQueries: [{ propertyName: "progressBar", first: true, predicate: ["progressBar"], descendants: true }], ngImport: i0, template: "<button\n  (mousedown)=\"startAction($event)\"\n  (mouseup)=\"stopAction()\"\n  (mouseleave)=\"stopAction()\"\n  (touchstart)=\"startAction($event)\"\n  (touchend)=\"stopAction()\"\n  (touchcancel)=\"stopAction()\"\n  [ngStyle]=\"{ 'background-color': backgroundColor }\"\n  class=\"press-hold-button\"\n>\n  <div class=\"icon-container\">\n    <ng-container *ngIf=\"currentState === 'start'\">\n      <ng-content select=\"[slot='left'][when='start']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'progress'\">\n      <ng-content select=\"[slot='left'][when='progress']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'finish'\">\n      <ng-content select=\"[slot='left'][when='finish']\"></ng-content>\n    </ng-container>\n  </div>\n\n  <span class=\"label-container\">{{ label }}</span>\n\n  <div class=\"icon-container\">\n    <ng-container *ngIf=\"currentState === 'start'\">\n      <ng-content select=\"[slot='right'][when='start']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'progress'\">\n      <ng-content select=\"[slot='right'][when='progress']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'finish'\">\n      <ng-content select=\"[slot='right'][when='finish']\"></ng-content>\n    </ng-container>\n  </div>\n\n  <div\n    #progressBar\n    class=\"progress-bar\"\n    [ngStyle]=\"{ 'background-color': progressColor }\"\n  ></div>\n</button>\n", styles: [":root{--button-width: 200px;--button-height: 50px;--button-color: white;--button-padding: 20px;--button-border-radius: 5px;--icon-font-size: 20px}button{position:relative;width:var(--button-width);height:var(--button-height);padding:var(--button-padding);border:none;border-radius:var(--button-border-radius);color:var(--button-color);outline:none;display:flex;justify-content:space-evenly;align-items:center;overflow:hidden;cursor:pointer}button .label-container{z-index:2;position:relative;flex-grow:1}button .icon-container{position:relative;z-index:2;font-size:var(--icon-font-size)}.progress-bar{height:100%;position:absolute;top:0;left:0;width:0%;transition:width .2s ease;z-index:1}.label-container{z-index:2;position:relative}\n"], dependencies: [{ kind: "ngmodule", type: CommonModule }, { kind: "directive", type: i1.NgIf, selector: "[ngIf]", inputs: ["ngIf", "ngIfThen", "ngIfElse"] }, { kind: "directive", type: i1.NgStyle, selector: "[ngStyle]", inputs: ["ngStyle"] }] }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.2.1", ngImport: i0, type: AngularPressHoldButton, decorators: [{
            type: Component,
            args: [{ selector: 'angular-press-hold-button', imports: [CommonModule], standalone: true, template: "<button\n  (mousedown)=\"startAction($event)\"\n  (mouseup)=\"stopAction()\"\n  (mouseleave)=\"stopAction()\"\n  (touchstart)=\"startAction($event)\"\n  (touchend)=\"stopAction()\"\n  (touchcancel)=\"stopAction()\"\n  [ngStyle]=\"{ 'background-color': backgroundColor }\"\n  class=\"press-hold-button\"\n>\n  <div class=\"icon-container\">\n    <ng-container *ngIf=\"currentState === 'start'\">\n      <ng-content select=\"[slot='left'][when='start']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'progress'\">\n      <ng-content select=\"[slot='left'][when='progress']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'finish'\">\n      <ng-content select=\"[slot='left'][when='finish']\"></ng-content>\n    </ng-container>\n  </div>\n\n  <span class=\"label-container\">{{ label }}</span>\n\n  <div class=\"icon-container\">\n    <ng-container *ngIf=\"currentState === 'start'\">\n      <ng-content select=\"[slot='right'][when='start']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'progress'\">\n      <ng-content select=\"[slot='right'][when='progress']\"></ng-content>\n    </ng-container>\n    <ng-container *ngIf=\"currentState === 'finish'\">\n      <ng-content select=\"[slot='right'][when='finish']\"></ng-content>\n    </ng-container>\n  </div>\n\n  <div\n    #progressBar\n    class=\"progress-bar\"\n    [ngStyle]=\"{ 'background-color': progressColor }\"\n  ></div>\n</button>\n", styles: [":root{--button-width: 200px;--button-height: 50px;--button-color: white;--button-padding: 20px;--button-border-radius: 5px;--icon-font-size: 20px}button{position:relative;width:var(--button-width);height:var(--button-height);padding:var(--button-padding);border:none;border-radius:var(--button-border-radius);color:var(--button-color);outline:none;display:flex;justify-content:space-evenly;align-items:center;overflow:hidden;cursor:pointer}button .label-container{z-index:2;position:relative;flex-grow:1}button .icon-container{position:relative;z-index:2;font-size:var(--icon-font-size)}.progress-bar{height:100%;position:absolute;top:0;left:0;width:0%;transition:width .2s ease;z-index:1}.label-container{z-index:2;position:relative}\n"] }]
        }], ctorParameters: () => [{ type: i0.Renderer2 }], propDecorators: { progressBar: [{
                type: ViewChild,
                args: ['progressBar']
            }], duration: [{
                type: Input
            }], backgroundColor: [{
                type: Input
            }], progressColor: [{
                type: Input
            }], labelStart: [{
                type: Input
            }], labelProgress: [{
                type: Input
            }], labelFinish: [{
                type: Input
            }], actionStarted: [{
                type: Output
            }], actionCancelled: [{
                type: Output
            }], actionFinished: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYW5ndWxhci1wcmVzcy1ob2xkLWJ1dHRvbi5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLXByZXNzLWhvbGQtYnV0dG9uL3NyYy9saWIvYW5ndWxhci1wcmVzcy1ob2xkLWJ1dHRvbi5jb21wb25lbnQudHMiLCIuLi8uLi8uLi8uLi9wcm9qZWN0cy9hbmd1bGFyLXByZXNzLWhvbGQtYnV0dG9uL3NyYy9saWIvYW5ndWxhci1wcmVzcy1ob2xkLWJ1dHRvbi5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDL0MsT0FBTyxFQUNMLFNBQVMsRUFFVCxZQUFZLEVBQ1osS0FBSyxFQUVMLE1BQU0sRUFFTixTQUFTLEdBQ1YsTUFBTSxlQUFlLENBQUM7OztBQVN2QixNQUFNLE9BQU8sc0JBQXNCO0lBcUJqQyxZQUFvQixRQUFtQjtRQUFuQixhQUFRLEdBQVIsUUFBUSxDQUFXO1FBbEI5QixhQUFRLEdBQVcsSUFBSSxDQUFDO1FBQ3hCLG9CQUFlLEdBQVcsU0FBUyxDQUFDO1FBQ3BDLGtCQUFhLEdBQVcsU0FBUyxDQUFDO1FBQ2xDLGVBQVUsR0FBVyxFQUFFLENBQUM7UUFDeEIsa0JBQWEsR0FBVyxFQUFFLENBQUM7UUFDM0IsZ0JBQVcsR0FBVyxFQUFFLENBQUM7UUFFeEIsa0JBQWEsR0FBRyxJQUFJLFlBQVksRUFBUSxDQUFDO1FBQ3pDLG9CQUFlLEdBQUcsSUFBSSxZQUFZLEVBQVEsQ0FBQztRQUMzQyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFRLENBQUM7UUFFcEQsVUFBSyxHQUFXLEVBQUUsQ0FBQztRQUVuQixpQkFBWSxHQUFvQyxPQUFPLENBQUM7UUFHaEQsa0JBQWEsR0FBVyxDQUFDLENBQUM7SUFFUSxDQUFDO0lBRTNDLFFBQVE7UUFDTixJQUFJLENBQUMsS0FBSyxHQUFHLElB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QkFBZ0IsQ0FBQyxDQUFDO1FBQ3ZDLENBQUM7UUFDRCxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsQ0FBQztRQUN2QixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7SUFDeEIsQ0FBQzs4R0E1RlUsc0JBQXNCO2tHQUF0QixzQkFBc0IsZ2ZDbkJuQyx5OUNBMENBLHl4QkQxQlksWUFBWTs7MkZBR1gsc0JBQXNCO2tCQVBsQyxTQUFTOytCQUNFLDJCQUEyQixXQUc1QixDQUFDLFlBQVksQ0FBQyxjQUNYLElBQUk7OEVBR1UsV0FBVztzQkFBcEMsU0FBUzt1QkFBQyxhQUFhO2dCQUVmLFFBQVE7c0JBQWhCLEtBQUs7Z0JBQ0csZUFBZTtzQkFBdkIsS0FBSztnQkFDRyxhQUFhO3NCQUFyQixLQUFLO2dCQUNHLFVBQVU7c0JBQWxCLEtBQUs7Z0JBQ0csYUFBYTtzQkFBckIsS0FBSztnQkFDRyxXQUFXO3NCQUFuQixLQUFLO2dCQUVJLGFBQWE7c0JBQXRCLE1BQU07Z0JBQ0csZUFBZTtzQkFBeEIsTUFBTTtnQkFDRyxjQUFjO3NCQUF2QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgRWxlbWVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBJbnB1dCxcbiAgT25Jbml0LFxuICBPdXRwdXQsXG4gIFJlbmRlcmVyMixcbiAgVmlld0NoaWxkLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYW5ndWxhci1wcmVzcy1ob2xkLWJ1dHRvbicsXG4gIHRlbXBsYXRlVXJsOiAnLi9hbmd1bGFyLXByZXNzLWhvbGQtYnV0dG9uLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vYW5ndWxhci1wcmVzcy1ob2xkLWJ1dHRvbi5jb21wb25lbnQuc2NzcyddLFxuICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXSxcbiAgc3RhbmRhbG9uZTogdHJ1ZSxcbn0pXG5leHBvcnQgY2xhc3MgQW5ndWxhclByZXNzSG9sZEJ1dHRvbiBpbXBsZW1lbnRzIE9uSW5pdCB7XG4gIEBWaWV3Q2hpbGQoJ3Byb2dyZXNzQmFyJykgcHJvZ3Jlc3NCYXI6IEVsZW1lbnRSZWYgfCB1bmRlZmluZWQ7XG5cbiAgQElucHV0KCkgZHVyYXRpb246IG51bWJlciA9IDE1MDA7XG4gIEBJbnB1dCgpIGJhY2tncm91bmRDb2xvcjogc3RyaW5nID0gJyMzNDk4ZGInO1xuICBASW5wdXQoKSBwcm9ncmVzc0NvbG9yOiBzdHJpbmcgPSAnIzI5ODBiOSc7XG4gIEBJbnB1dCgpIGxhYmVsU3RhcnQ6IHN0cmluZyA9ICcnO1xuICBASW5wdXQoKSBsYWJlbFByb2dyZXNzOiBzdHJpbmcgPSAnJztcbiAgQElucHV0KCkgbGFiZWxGaW5pc2g6IHN0cmluZyA9ICcnO1xuXG4gIEBPdXRwdXQoKSBhY3Rpb25TdGFydGVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgYWN0aW9uQ2FuY2VsbGVkID0gbmV3IEV2ZW50RW1pdHRlcjx2b2lkPigpO1xuICBAT3V0cHV0KCkgYWN0aW9uRmluaXNoZWQgPSBuZXcgRXZlbnRFbWl0dGVyPHZvaWQ+KCk7XG5cbiAgbGFiZWw6IHN0cmluZyA9ICcnO1xuXG4gIGN1cnJlbnRTdGF0ZTogJ3N0YXJ0JyB8ICdwcm9ncmVzcycgfCAnZmluaXNoJyA9ICdzdGFydCc7XG5cbiAgcHJpdmF0ZSBwcm9ncmVzc0ludGVydmFsOiBhbnk7XG4gIHByaXZhdGUgcHJvZ3Jlc3NXaWR0aDogbnVtYmVyID0gMDtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5sYWJlbCA9IHRoaXMubGFiZWxTdGFydDtcbiAgfVxuXG4gIHN0YXJ0QWN0aW9uKGV2ZW50OiBFdmVudCk6IHZvaWQge1xuICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgaWYgKHRoaXMucHJvZ3Jlc3NXaWR0aCA8IDEwMCkge1xuICAgICAgdGhpcy5jbGVhclByb2dyZXNzKCk7XG4gICAgICB0aGlzLmxhYmVsID0gdGhpcy5sYWJlbFByb2dyZXNzO1xuICAgICAgdGhpcy5jdXJyZW50U3RhdGUgPSAncHJvZ3Jlc3MnO1xuICAgICAgdGhpcy5hY3Rpb25TdGFydGVkLmVtaXQoKTtcbiAgICAgIHRoaXMucHJvZ3Jlc3NJbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgdGhpcy5wcm9ncmVzc1dpZHRoID0gTWF0aC5taW4oXG4gICAgICAgICAgMTAwLFxuICAgICAgICAgIHRoaXMucHJvZ3Jlc3NXaWR0aCArIDEwMCAvICh0aGlzLmR1cmF0aW9uIC8gMTAwKVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKCk7XG4gICAgICAgIGlmICh0aGlzLnByb2dyZXNzV2lkdGggPj0gMTAwKSB7XG4gICAgICAgICAgdGhpcy5hY3Rpb25TdWNjZXNzKCk7XG4gICAgICAgIH1cbiAgICAgIH0sIDEwMCk7XG4gICAgfVxuICB9XG5cbiAgc3RvcEFjdGlvbihldmVudD86IEV2ZW50KTogdm9pZCB7XG4gICAgaWYgKGV2ZW50KSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH1cbiAgICBpZiAodGhpcy5wcm9ncmVzc1dpZHRoIDwgMTAwKSB7XG4gICAgICB0aGlzLmxhYmVsID0gdGhpcy5sYWJlbFN0YXJ0O1xuICAgICAgdGhpcy5jdXJyZW50U3RhdGUgPSAnc3RhcnQnO1xuICAgICAgdGhpcy5hY3Rpb25DYW5jZWxsZWQuZW1pdCgpO1xuICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLnByb2dyZXNzSW50ZXJ2YWwpO1xuICAgICAgdGhpcy5wcm9ncmVzc0ludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICB0aGlzLnByb2dyZXNzV2lkdGggPSBNYXRoLm1heChcbiAgICAgICAgICAwLFxuICAgICAgICAgIHRoaXMucHJvZ3Jlc3NXaWR0aCAtIDEwMCAvICh0aGlzLmR1cmF0aW9uIC8gMTAwKVxuICAgICAgICApO1xuICAgICAgICB0aGlzLnVwZGF0ZVByb2dyZXNzKCk7XG4gICAgICAgIGlmICh0aGlzLnByb2dyZXNzV2lkdGggPD0gMCkge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5wcm9ncmVzc0ludGVydmFsKTtcbiAgICAgICAgfVxuICAgICAgfSwgMTAwKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGFjdGlvblN1Y2Nlc3MoKTogdm9pZCB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnByb2dyZXNzSW50ZXJ2YWwpO1xuICAgIHRoaXMubGFiZWwgPSB0aGlzLmxhYmVsRmluaXNoO1xuICAgIHRoaXMuY3VycmVudFN0YXRlID0gJ2ZpbmlzaCc7XG4gICAgdGhpcy5hY3Rpb25GaW5pc2hlZC5lbWl0KCk7XG4gIH1cblxuICBwcml2YXRlIHVwZGF0ZVByb2dyZXNzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnByb2dyZXNzQmFyICYmIHRoaXMucHJvZ3Jlc3NCYXIubmF0aXZlRWxlbWVudCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShcbiAgICAgICAgdGhpcy5wcm9ncmVzc0Jhci5uYXRpdmVFbGVtZW50LFxuICAgICAgICAnd2lkdGgnLFxuICAgICAgICBgJHt0aGlzLnByb2dyZXNzV2lkdGh9JWBcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjbGVhclByb2dyZXNzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnByb2dyZXNzV2lkdGggPCAxMDAgJiYgdGhpcy5wcm9ncmVzc0ludGVydmFsKSB7XG4gICAgICBjbGVhckludGVydmFsKHRoaXMucHJvZ3Jlc3NJbnRlcnZhbCk7XG4gICAgfVxuICAgIHRoaXMucHJvZ3Jlc3NXaWR0aCA9IDA7XG4gICAgdGhpcy51cGRhdGVQcm9ncmVzcygpO1xuICB9XG59XG4iLCI8YnV0dG9uXG4gIChtb3VzZWRvd24pPVwic3RhcnRBY3Rpb24oJGV2ZW50KVwiXG4gIChtb3VzZXVwKT1cInN0b3BBY3Rpb24oKVwiXG4gIChtb3VzZWxlYXZlKT1cInN0b3BBY3Rpb24oKVwiXG4gICh0b3VjaHN0YXJ0KT1cInN0YXJ0QWN0aW9uKCRldmVudClcIlxuICAodG91Y2hlbmQpPVwic3RvcEFjdGlvbigpXCJcbiAgKHRvdWNoY2FuY2VsKT1cInN0b3BBY3Rpb24oKVwiXG4gIFtuZ1N0eWxlXT1cInsgJ2JhY2tncm91bmQtY29sb3InOiBiYWNrZ3JvdW5kQ29sb3IgfVwiXG4gIGNsYXNzPVwicHJlc3MtaG9sZC1idXR0b25cIlxuPlxuICA8ZGl2IGNsYXNzPVwiaWNvbi1jb250YWluZXJcIj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY3VycmVudFN0YXRlID09PSAnc3RhcnQnXCI+XG4gICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJbc2xvdD0nbGVmdCddW3doZW49J3N0YXJ0J11cIj48L25nLWNvbnRlbnQ+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImN1cnJlbnRTdGF0ZSA9PT0gJ3Byb2dyZXNzJ1wiPlxuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3Nsb3Q9J2xlZnQnXVt3aGVuPSdwcm9ncmVzcyddXCI+PC9uZy1jb250ZW50PlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjdXJyZW50U3RhdGUgPT09ICdmaW5pc2gnXCI+XG4gICAgICA8bmctY29udGVudCBzZWxlY3Q9XCJbc2xvdD0nbGVmdCddW3doZW49J2ZpbmlzaCddXCI+PC9uZy1jb250ZW50PlxuICAgIDwvbmctY29udGFpbmVyPlxuICA8L2Rpdj5cblxuICA8c3BhbiBjbGFzcz1cImxhYmVsLWNvbnRhaW5lclwiPnt7IGxhYmVsIH19PC9zcGFuPlxuXG4gIDxkaXYgY2xhc3M9XCJpY29uLWNvbnRhaW5lclwiPlxuICAgIDxuZy1jb250YWluZXIgKm5nSWY9XCJjdXJyZW50U3RhdGUgPT09ICdzdGFydCdcIj5cbiAgICAgIDxuZy1jb250ZW50IHNlbGVjdD1cIltzbG90PSdyaWdodCddW3doZW49J3N0YXJ0J11cIj48L25nLWNvbnRlbnQ+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPG5nLWNvbnRhaW5lciAqbmdJZj1cImN1cnJlbnRTdGF0ZSA9PT0gJ3Byb2dyZXNzJ1wiPlxuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3Nsb3Q9J3JpZ2h0J11bd2hlbj0ncHJvZ3Jlc3MnXVwiPjwvbmctY29udGVudD5cbiAgICA8L25nLWNvbnRhaW5lcj5cbiAgICA8bmctY29udGFpbmVyICpuZ0lmPVwiY3VycmVudFN0YXRlID09PSAnZmluaXNoJ1wiPlxuICAgICAgPG5nLWNvbnRlbnQgc2VsZWN0PVwiW3Nsb3Q9J3JpZ2h0J11bd2hlbj0nZmluaXNoJ11cIj48L25nLWNvbnRlbnQ+XG4gICAgPC9uZy1jb250YWluZXI+XG4gIDwvZGl2PlxuXG4gIDxkaXZcbiAgICAjcHJvZ3Jlc3NCYXJcbiAgICBjbGFzcz1cInByb2dyZXNzLWJhclwiXG4gICAgW25nU3R5bGVdPVwieyAnYmFja2dyb3VuZC1jb2xvcic6IHByb2dyZXNzQ29sb3IgfVwiXG4gID48L2Rpdj5cbjwvYnV0dG9uPlxuIl19